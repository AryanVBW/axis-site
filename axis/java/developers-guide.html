<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="../skin/tigris.css" type="text/css">
<link rel="stylesheet" href="../skin/mysite.css" type="text/css">
<link rel="stylesheet" href="../skin/site.css" type="text/css">
<link media="print" rel="stylesheet" href="../skin/print.css" type="text/css">
<title>WebServices - Axis</title>
</head>
<body bgcolor="white" class="composite">
<div id="banner">
<table width="100%" cellpadding="0" cellspacing="0" summary="banner" border="0">
<tbody>
<tr>
<td align="left">
<div class="groupLogo">
<a href="http://ws.apache.org/"><img border="0" class="logoImage" alt="The Apache WebServices Project" src="../images/project-logo.png"></a>
</div>
</td><td nowrap="1" width="100%" align="left">
<div class="projectTitleImg">
<br>
<a href=""><img border="0" class="logoImage" alt="Web Services - Axis" src="../images/wsaxis.png"></a>
</div>
</td><td align="right">
<div class="projectLogo">
<a href="http://ws.apache.org/axis/"><img border="0" class="logoImage" alt="The Apache Axis Project" src="../images/axis3.jpg"></a>
</div>
</td>
</tr>
</tbody>
</table>
</div>
<table width="100%" cellpadding="0" cellspacing="0" border="0" summary="nav" id="breadcrumbs">
<tbody>
<tr class="status">
<td width="100%">&nbsp;&nbsp;&nbsp;&nbsp;<a href="http://www.apache.org/">Apache</a> | <a href="http://ws.apache.org/">Web Services</a> | <a href="http://ws.apache.org/axis/">Axis</a></td><td nowrap="1" align="right">
<form method="get" action="http://www.google.com/search" target="_blank">Search <input type="hidden" name="sitesearch" value="ws.apache.org"><input type="text" id="query" name="q" size="10"><img class="spacer" src="skin/images/spacer.gif" alt="" width="5" height="1"><input type="submit" value="Go" name="Search">
</form>
</td>
</tr>
</tbody>
</table>
<table id="main" width="100%" cellpadding="8" cellspacing="0" summary="" border="0">
<tbody>
<tr valign="top">
<td id="leftcol">
<div id="navcolumn">
<div class="menuBar">
<div class="menu">
<span class="menuLabel">Axis</span>
 
<div class="menuItem">
<a href="../index.html">Introduction</a>
</div>
 
<div class="menuItem">
<a href="../news.html">News</a>
</div>

 
<div class="menuItem">
<a href="http://wiki.apache.org/ws/FrontPage/Axis">FAQ/Wiki</a>
</div>
 
<div class="menu">
<span class="menuLabel">Get Involved</span>
  
<div class="menuItem">
<a href="../overview.html">Overview</a>
</div>
  
<div class="menuItem">
<a href="../cvs.html">SVN Repository</a>
</div>
  
<div class="menuItem">
<a href="../mail.html">Mailing Lists</a>
</div>
  
<div class="menuItem">
<a href="../ref.html">Reference Library</a>
</div>
  
<div class="menuItem">
<a href="../bugs.html">Bugs</a>
</div>
  
<div class="menuItem">
<a href="../howtobuild.html">HowToBuildSite</a>
</div>
 
</div>
 
<div class="menu">
<span class="menuLabel">Axis (Java)</span>  
  
<div class="menuItem">
<a href="../java/index.html">Documentation</a>
</div>
  
  
<div class="menuItem">
<a href="../java/releases.html">Releases</a>
</div>
  
<div class="menuItem">
<a href="../java/install.html">Installation</a>
</div>
  
<div class="menuItem">
<a href="../java/user-guide.html">User's Guide</a>
</div>
  
<div class="menuItem">
<span class="menuSelected">Developer's Guide</span>
</div>
  
<div class="menuItem">
<a href="../java/integration-guide.html">Integration Guide</a>
</div>
  
<div class="menuItem">
<a href="../java/architecture-guide.html">Architecture Guide</a>
</div>
  
<div class="menuItem">
<a href="../java/reference.html">Reference Guide</a>
</div>
  
<div class="menuItem">
<a href="../java/reading.html">Reading Guide</a>
</div>
  
<div class="menuItem">
<a href="../java/requirements.html">Requirements</a>
</div>
 
</div>
 
<div class="menu">
<span class="menuLabel">Axis C++</span>
  
<div class="menuItem">
<a href="http://ws.apache.org/axis/cpp/index.html">Home</a>
</div>
  
<div class="menuItem">
<a href="http://ws.apache.org/axis/cpp/documentation.html">Documentation</a>
</div>
  
<div class="menuItem">
<a href="http://ws.apache.org/axis/cpp/download.html">Download</a>
</div>
  
<div class="menuItem">
<a href="http://wiki.apache.org/ws/FrontPage/AxisCPP">Wiki Pages</a>
</div>
  
<div class="menuItem">
<a href="http://ws.apache.org/axis/cpp/who.html">Who we are</a>
</div>
 
</div>

<div class="menu">
<span class="menuLabel">Downloads</span>
  
<div class="menuItem">
<a href="../interim.html">Interim Drops</a>
</div>
  
<div class="menuItem">
<a href="http://svn.apache.org/viewcvs.cgi/webservices/axis/trunk/">Source Code</a>
</div>

</div>

<div class="menu">
<span class="menuLabel">Translation</span>
  
<div class="menuItem">
<a href="http://ws.apache.org/axis/ja/index.html">Japanese</a>
</div>

</div>

<div class="menu">
<span class="menuLabel">Related Projects</span>
  
<div class="menuItem">
<a href="http://ws.apache.org/wsif/">WSIF</a>
</div>
  
<div class="menuItem">
<a href="http://ws.apache.org/juddi/">jUDDI</a>
</div>
  
<div class="menuItem">
<a href="http://wsdl4j.sourceforge.net">WSDL4J</a>
</div>
  
<div class="menuItem">
<a href="http://www.uddi4j.org/">UDDI4J</a>
</div>

</div>

<div class="menu">
<span class="menuLabel">Misc</span>
  
<div class="menuItem">
<a href="../who.html">Who we are</a>
</div>
  
<div class="menuItem">
<a href="../contact.html">Contact</a>
</div>
  
<div class="menuItem">
<a href="../legal.html">Legal</a>
</div>
  
<div class="menuItem">
<a href="../docs.html">Notes/Docs</a>
</div>

</div>


</div>
</div>
</div>
</td><td>
<div id="bodycol">
<div class="app">
<div class="h3">
  
  


<a name="AxisDevelopersGuide"></a>

<div class="h3">
<h3>Axis Developer's Guide</h3>
</div>



<p>
<i>1.2 Version</i>
<br>
  
<i>Feedback: <a href="mailto:axis-dev@ws.apache.org">axis-dev@ws.apache.org</a></i>
</p>


<a name="TableOfContents"></a>

<div class="h4">
<h4>Table of Contents</h4>
</div>



<ul>
  
<li>
<a href="#Introduction">Introduction</a>
</li>
  
<li>
<a href="#GeneralGuidelines">General Guidelines</a>
</li>
  
<li>
<a href="#DevelopmentEnvironment">Development Environment</a>
</li>
  
<li>
<a href="#Pluggable-Components">Pluggable-Components</a>
</li>
  
<ul>
    
<li>
<a href="#Discovery">Discovery</a>
</li>
    
<li>
<a href="#Logging/Tracing">Logging/Tracing</a>
</li>
    
<li>
<a href="#AxisServletQueryStringPlug-ins">Axis Servlet Query String Plug-ins</a>
</li>
  
</ul>
  
<li>
<a href="#ConfigurationProperties">Configuration Properties</a>
</li>
  
<li>
<a href="#ExceptionHandling">Exception Handling</a>
</li>
  
<li>
<a href="#CompileAndRun">Compile and Run</a>
</li>
  
<li>
<a href="#Internationalization">Internationalization</a>
</li>
  
<ul>
    
<li>
<a href="#DeveloperGuidelines">Developer Guidelines</a>
</li>
    
<li>
<a href="#Interface">Interface</a>
</li>
    
<li>
<a href="#ExtendingMessageFiles">Extending Message Files</a>
</li>
  
</ul>
  
<li>
<a href="#AddingTestcases">Adding Testcases</a>
</li>
  
<li>
<a href="#CreatingAWSDLTest">Creating a WSDL Test</a>
</li>
  
<li>
<a href="#TestStructure">Test Structure</a>
</li>
  
<li>
<a href="#AddingSourceCodeChecks">Adding Source Code Checks</a>
</li>
  
<li>
<a href="#JUnitAndAxis">JUnit and Axis</a>
</li>
  
<li>
<a href="#UsingTcpmonToMonitorFunctionalTests">Using tcpmon to Monitor Functional Tests</a>
</li>
  
<li>
<a href="#UsingSOAPMonitorToMonitorFunctionalTests">Using SOAP Monitor to Monitor Functional Tests</a>
</li>
  
<li>
<a href="#RunningASingleFunctionalTest">Running a Single Functional Test</a>
</li>
  
<li>
<a href="#Debugging">Debugging</a>
</li>
  
<ul>
    
<li>
<a href="#TurningOnDebugOutput">Turning on Debug Output</a>
</li>
    
<li>
<a href="#WritingTemporaryOutput">Writing Temporary Output</a>
</li>
  
</ul>
  
<li>
<a href="#RunningTheJAX-RPCCompatibilityTests">Running the JAX-RPC Compatibility Tests</a>
</li>

</ul>




<a name="Introduction"></a>

<div class="h4">
<h4>Introduction</h4>
</div>



<p>This guide is a collection of topics related to developing code for Axis.</p>




<a name="GeneralGuidelines"></a>

<div class="h4">
<h4>General Guidelines</h4>
</div>



<ul>
  
<li>Axis specific information (cvs repository access, mailing list info, etc.) can be found on the <a href="http://ws.apache.org/axis/index.html">Axis Home Page</a>.</li>
  
<li>Axis uses the <a href="http://jakarta.apache.org/site/guidelines.html">Jakarta Project Guidelines.</a>
</li>
  
<li>Code changes should comply with <a href="http://java.sun.com/docs/codeconv/html/CodeConvTOC.doc.html">"Code Conventions for the Java Programming Language"</a>
</li>
  
<li>When fixing a bug, please include the href of the bug in the cvs commit message.</li>
  
<li>Incompatible changes to <a href="user-guide.html#PublishedAxisInterfaces">published Axis interfaces</a> should be avoided where possible. When changes are necessary, for example to maintain or improve the overall modularity of Axis, the impact on users must be considered and, preferably, documented.</li>
  
<li>If you are making a big change that may affect interoperability, please run the <a href="http://xml.apache.org/~rubys/echotest.pl">echotest2 round 2 interop test</a> to ensure that your change does not result in any new interop failures. You will also need the <a href="http://xml.apache.org/~rubys/client_deploy.wsdd">client_deploy.wsdd</a>. Here are the <a href="http://xml.apache.org/~rubys/ApacheClientInterop.html">nightly interop test results</a>.</li>

</ul>




<a name="DevelopmentEnvironment"></a>

<div class="h4">
<h4>Development Environment</h4>
</div>



<p>The following packages are required for axis development:</p>


<ul>
  
<li>
<a href="http://jakarta.apache.org/ant/index.html">ant</a> - Java based build tool. <b>Please Note: Version 1.5 OR HIGHER is required</b>
</li>
  
<li>
<a href="http://www.junit.org">junit</a> - testing package</li>
  
<li>
<a href="http://xml.apache.org/dist/xerces-j">xerces</a> - xml processor</li>
  
<li>Install Java 1.3.1 JDK (or later).</li>

</ul>


<p>The Axis jar files are built in the <span class="codefrag">xml-axis/java/build/lib</span> directory. Here is an example CLASSPATH, which I use when developing code:</p>


<pre class="code">G:\xerces\xerces-1_4_2\xerces.jar
G:\junit3.7\junit.jar
G:\xml-axis\java\build\lib\commons-discovery.jar
G:\xml-axis\java\build\lib\commons-logging.jar
G:\xml-axis\java\build\lib\wsdl4j.jar
G:\xml-axis\java\build\lib\axis.jar
G:\xml-axis\java\build\lib\log4j-1.2.8.jar
G:\xml-axis\java\build\classes
</pre>


<p>If you access the internet via a proxy server, you'll need to set an environment variable so that the Axis tests do the same. Set ANT_OPTS to, for example:</p>


<pre class="code">-Dhttp.proxyHost=proxy.somewhere.com
-Dhttp.proxyPort=80
-Dhttp.nonProxyHosts="localhost"</pre>




<a name="Pluggable-Components"></a>

<div class="h4">
<h4>Pluggable-Components</h4>
</div>



<p>The <a href="architecture-guide.html">Axis Architecture Guide</a> explains the requirements for pluggable components.</p>


<a name="Discovery"></a>

<div class="h2">
<h2>Discovery</h2>
</div>



<p>An Axis-specific component factory should be created of the form:</p>


<p>
<span class="codefrag">org.apache.axis.components.&lt;componentType&gt;.&lt;factoryClassName&gt;</span>
</p>


<p>For example, <span class="codefrag">org.apache.axis.components.logger.LogFactory</span> is the factory, or discovery mechanism, for the logger component/service.</p>


<p>The <span class="codefrag">org.apache.axis.components.image</span> package demonstrates both a factory, and supporting classes for different image tools used by Axis. This is representative of a pluggable component that uses external tooling, isolating it behind a 'thin' wrapper to Axis that provides only a limited interface to meet Axis minimal requirements. This allows future designers and implementors to gain an explicit understanding of the Axis's
  specific requirements on these tools.</p>
  



<a name="Logging/Tracing"></a>

<div class="h2">
<h2>Logging/Tracing</h2>
</div>



<p>Axis logging and tracing is based on the Logging component of the <a href="http://jakarta.apache.org/commons/index.html">Jakarta Commons</a> project, or the Jakarta Commons Logging (JCL) SPI. The JCL provides a Log interface with thin-wrapper implementations for other logging tools, including <a href="http://jakarta.apache.org/log4j/docs/index.html">Log4J</a>, <a href="http://jakarta.apache.org/avalon/logkit/index.html">Avalon LogKit</a>, and <a>JDK 1.4</a>. The interface maps closely to Log4J and LogKit.</p>


<div class="h5">
<h5>Using the Logger SPI</h5>
</div>



<p>To use the JCL SPI from a Java class, include the following import statements:</p>


<pre class="code">import org.apache.commons.logging.Log;
import org.apache.axis.components.logger.LogFactory;</pre>


<p>For each class definition, declare and initialize a <span class="codefrag">log</span> attribute as follows:</p>


<pre class="code">public class CLASS {
  private static Log log =
    LogFactory.getLog(CLASS.class);
    ...</pre>


<p>Messages are logged to a <i>logger</i>, such as <span class="codefrag">log</span> by invoking a method corresponding to <i>priority</i>: The <span class="codefrag">Log</span> interface defines the following methods for use in writing log/trace messages to the log:</p>


<pre class="code">log.fatal(Object message);
log.fatal(Object message, Throwable t);
log.error(Object message);
log.error(Object message, Throwable t);
log.warn(Object message);
log.warn(Object message, Throwable t);
log.info(Object message);
log.info(Object message, Throwable t);
log.debug(Object message);
log.debug(Object message, Throwable t);
log.trace(Object message);
log.trace(Object message, Throwable t);</pre>


<p>While semantics for these methods are ultimately defined by the implementation of the Log interface, it is expected that the severity of messages is ordered as shown in the above list.</p>


<p>In addition to the logging methods, the following are provided:</p>


<pre class="code">log.isFatalEnabled();
log.isErrorEnabled();
log.isWarnEnabled();
log.isInfoEnabled();
log.isDebugEnabled();
log.isTraceEnabled();</pre>


<p>These are typically used to guard code that only needs to execute in support of logging, and that introduces undesirable runtime overhead in the general case (logging disabled).</p>




<div class="h5">
<h5>Guidelines</h5>
</div>





<div class="h5">
<h5>Message Priorities</h5>
</div>



<p>It is important to ensure that log message are appropriate in content and severity. The following guidelines are suggested:</p>


<ul>
  
<li>fatal - Severe errors that cause the Axis server to terminate prematurely. Expect these to be immediately visible on a console, and MUST be internationalized.</li>
  
<li>error - Other runtime errors or unexpected conditions. Expect these to be immediately visible on a console, and MUST be internationalized.</li>
  
<li>warn - Use of deprecated APIs, poor use of API, almost errors, other runtime situations that are undesirable or unexpected, but not necessarily "wrong". Expect these to be immediately visible on a console, and MUST be internationalized.</li>
  
<li>info - Interesting runtime events (startup/shutdown). Expect these to be immediately visible on a console, so be conservative and keep to a minimum. These MUST be internationalized.</li>
  
<li>debug - detailed information on flow of through the system. Expect these to be written to logs only. These NEED NOT be internationalized, but it never hurts...</li>
  
<li>trace - more detailed information. Expect these to be written to logs only. These NEED NOT be internationalized, but it never hurts...</li>

</ul>




<div class="h5">
<h5>Configuring the Logger</h5>
</div>



<p>The Jakarta Commons Logging (JCL) SPI can be configured to use different logging toolkits. To configure which logger is used by the JCL, see the <a href="integration-guide.html">Axis System Integration Guide</a>.</p>


<p>Configuration of the behavior of the JCL ultimately depends upon the logging toolkit being used. The JCL SPI (and hence Axis) uses <a href="http://jakarta.apache.org/log4j/docs/index.html">Log4J</a> by default if it is available (in the CLASSPATH).</p>




<div class="h5">
<h5>Log4J</h5>
</div>



<p>As <a href="http://jakarta.apache.org/log4j/docs/index.html">Log4J</a> is the prefered/default logger for Axis, a <i>few</i> details are presented herein to get the developer going.</p>


<p>Configure Log4J using system properties and/or a properties file:</p>


<ul>
  
<li>
<b>log4j.configuration=<i>log4j.properties</i></b>
    
<p>Use this system property to specify the name of a Log4J configuration file. If not specified, the default configuration file is <i>log4j.properties</i>. A <i>log4j.properties</i> file is provided in <span class="codefrag">axis.jar</span>.</p>
    
<p>This properties file can sometimes be overridden by placing a file of the same name so as to appear before <span class="codefrag">axis.jar</span> in the CLASSPATH. However, the precise behaviour depends on the classloader that is in use at the time, so we don't recommend this technique.</p>
    
<p>A safe way of overriding the properties file is to replace it in axis.jar. However, this isn't very convenient, especially if you want to tweak the properties during a debug session to filter out unwanted log entries. A more convenient alternative is to use an absolute file path to specify the properties file. This will even ignore web app's and their classloaders. So, for example on Linux, you could specify the system property:</p>
    
<p>
<span class="codefrag">log4j.configuration=file:/home/fred/log4j.props</span>
</p>
  
</li>

  
<li>
<b>log4j.debug</b>
    
<p>A good way of telling where log4j is getting its configuration from is to set this system property and look at the messages on standard output.</p>
  
</li>

  
<li>
<b>log4j.rootCategory=<i>priority</i> [, <i>appender</i>]*</b>
    
<p>Set the default (root) logger priority.</p>
  
</li>

  
<li>
<b>log4j.logger.<i>logger.name</i>=<i>priority</i></b>
    
<p>Set the priority for the named logger and all loggers hierarchically lower than, or below, the named logger. <i>logger.name</i> corresponds to the parameter of <span class="codefrag">LogFactory.getLog(logger.name)</span>, used to create the logger instance. Priorities are: <span class="codefrag">DEBUG</span>, <span class="codefrag">INFO</span>, <span class="codefrag">WARN</span>, <span class="codefrag">ERROR</span>, or <span class="codefrag">FATAL</span>.</p>

    
<p>Log4J understands hierarchical names, enabling control by package or high-level qualifiers: <span class="codefrag">log4j.logger.org.apache.axis.encoding=DEBUG</span> will enable debug messages for all classes in both <span class="codefrag">org.apache.axis.encoding</span> and <span class="codefrag">org.apache.axis.encoding.ser</span>. Likewise, setting <span class="codefrag">log4j.logger.org.apache.axis=DEBUG</span> will enable debug message for all Axis classes, but not for other Jakarta projects.</p>

    
<p>A combination of settings will enable you to see the log events that you are interested in and omit the others. For example, the combination:</p>
    
<pre class="code">log4j.logger.org.apache.axis=DEBUG 
log4j.logger.org.apache.axis.encoding=INFO
log4j.logger.org.apache.axis.utils=INFO
log4j.logger.org.apache.axis.message=INFO</pre>
    
<p>cuts down the number of a log entries produced by a single request to a manageable number.</p>
  
</li>

  
<li>
<b>log4j.appender.<i>appender</i>.Threshold=<i>priority</i></b>
    
<p>Log4J <i>appenders</i> correspond to different output devices: console, files, sockets, and others. If appender's <i>threshold</i> is less than or equal to the message priority then the message is written by that appender. This allows different levels of detail to be appear at different
log destinations.</p>
    
<p>For example: one can capture DEBUG (and higher) level information in a logfile, while limiting console output to INFO (and higher).</p>
  
</li>

</ul>






<a name="AxisServletQueryStringPlug-ins"></a>

<div class="h2">
<h2>Axis Servlet Query String Plug-ins</h2>
</div>



<p>Any servlet that is derived from the <span class="codefrag">org.apache.axis.transport.http.AxisServlet</span> class supports a number of standard query strings (<i>?list</i>, <i>?method</i>, and <i>?wsdl</i>) that provide information from or perform operations on a web service (for instance, <i>?method</i> is used to invoke a method on a web service and <i>?wsdl</i> is used to retrieve the WSDL document for a web service). Axis servlets are not limited to these three query strings and developers may create their own "plug-ins" by implementing the <span class="codefrag">org.apache.axis.transport.http.QSHandler</span> interface. There is one method in this interface that must be implemented, with the following signature:</p>


<p>
<span class="codefrag">public void invoke (MessageContext msgContext) throws AxisFault;</span>
</p>


<p>The <span class="codefrag">org.apache.axis.MessageContext</span> instance provides the developer with a number of useful objects (such as the Axis engine instance, and HTTP servlet objects) that are accessible by its <span class="codefrag">getProperty</span> method. The following constants can be used to retrieve various objects provided by the Axis servlet invoking the query string plug-in:</p>


<ul>
  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.PLUGIN_NAME</b>
    
<p>A <span class="codefrag">String</span> containing the name of the query string plug-in. For instance, if the query string <i>?wsdl</i> is provided, the name of the plugin is <i>wsdl</i>.</p>
  
</li>

  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.PLUGIN_SERVICE_NAME</b>
    
<p>A <span class="codefrag">String</span> containing the name of the Axis servlet that inovked the query string plug-in.</p>
  
</li>

  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.PLUGIN_IS_DEVELOPMENT</b>
    
<p>A <span class="codefrag">Boolean</span> containing <span class="codefrag">true</span> if this version of Axis is considered to be in development mode, <span class="codefrag">false</span> otherwise.</p>
  
</li>

  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.PLUGIN_ENABLE_LIST</b>
    
<p>A <span class="codefrag">Boolean</span> containing <span class="codefrag">true</span> if listing of the Axis server configuration is allowed, <span class="codefrag">false</span> otherwise.</p>
  
</li>

  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.PLUGIN_ENGINE</b>
    
<p>A <span class="codefrag">org.apache.axis.server.AxisServer</span> object containing the engine for the Axis server.</p>
  
</li>

  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.MC_HTTP_SERVLETREQUEST</b>
    
<p>The <span class="codefrag">javax.servlet.http.HttpServletRequest</span> object from the Axis servlet that invoked the query string plug-in</p>
  
</li>

  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.MC_HTTP_SERVLETRESPONSE</b>
    
<p>The <span class="codefrag">javax.servlet.http.HttpServletResponse</span> object from the Axis servlet that invoked the query string plug-in</p>
  
</li>

  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.PLUGIN_WRITER</b>
    
<p>The <span class="codefrag">java.io.PrintWriter</span> object from the Axis servlet that invoked the query string plug-in</p>
  
</li>

  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.PLUGIN_LOG</b>
    
<p>The <span class="codefrag">org.apache.commons.logging.Log</span> object from the Axis servlet that invoked the query string plug-in, which is used to log messages.</p>
  
</li>

  
<li>
<b>org.apache.axis.transport.http.HTTPConstants.PLUGIN_EXCEPTION_LOG</b>
    
<p>The <span class="codefrag">org.apache.commons.logging.Log</span> object from the Axis servlet that invoked the query string plug-in, which is used to log exceptions.</p>
  
</li>

</ul>


<p>Query string plug-in development is much like normal servlet development since the same basic information and methods of output are available to the developer. Below is an example query string plug-in which simply displays the value of the system clock (<span class="codefrag">import</span> statements have been omitted for brevity):</p>


<pre class="code">public class QSClockHandler implements QSHandler {
  public void invoke (MessageContext msgContext) throws AxisFault {
    PrintWriter out = (PrintWriter) msgContext.getProperty (HTTPConstants.PLUGIN_WRITER);
    HttpServletResponse response = (HttpServletResponse)
        msgContext.getProperty (HTTPConstants.MC_HTTP_SERVLETRESPONSE);

    response.setContentType ("text/html");

    out.println ("&lt;HTML&gt;&lt;BODY&gt;&lt;H1&gt;" + System.currentTimeMillis()
        + "&lt;/H1&gt;&lt;/BODY&gt;&lt;/HTML&gt;");
  }
}</pre>


<p>Once a query string plug-in class has been created, the Axis server must be set up to recognize the query string which invokes it. See the section <a href="reference.html#DeploymentWSDDReference">Deployment (WSDD) Reference</a> in the <a href="reference.html">Axis Reference Guide</a> for information on how the HTTP transport section of the Axis server configuration file must be set up.</p>






<a name="ConfigurationProperties"></a>

<div class="h4">
<h4>Configuration Properties</h4>
</div>



<p>Axis is in the process of moving away from using system properties as the primary point of internal configuration. Avoid calling <span class="codefrag">System.getProperty()</span>, and instead call <span class="codefrag">AxisProperties.getProperty</span>. <span class="codefrag">AxisProperties.getProperty</span> will call <span class="codefrag">System.getProperty</span>, and will (eventually) query other sources of configuration information.</p>


<p>Using this central point of access will allow the global configuration system to be redesigned to better support multiple Axis engines in a single JVM.</p>




<a name="ExceptionHandling"></a>

<div class="h4">
<h4>Exception Handling</h4>
</div>



<p>Guidelines for Axis exception handling are based on best-practices for exception handling. While there are details specific to Axis in these guidelines, they apply in principle to any project; they are included here for two reasons. First, because they are not listed elsewhere in the Apache/Jakarta guidelines (or haven't been found). Second, because adherence to these guidelines is considered crucial to enterprise ready middleware.</p>


<p>These guidelines are fundamentally independent of programming language. They are based on experience, but proper credit must be given to <i>More Effective C++</i>, by Scott Meyers, for opening the eyes of the innocent(?) many years ago.</p>


<p>Finally, these are guidelines. There will always be exceptions to these guidelines, in which case all that can be asked (as per these guidelines) is that they be logged in the form of comments in the code.</p>


<ul>
  
<li>
<b>Primary Rule: Only Catch An Exception If You Know What To Do With It</b>
    
<p>If code catches an exception, it should know what to do with it at that point in the program. Any exception to this rule must be documented with a GOOD reason. Code reviewers are invited to put on their vulture beaks and peck away...</p>
    
<p>There are a few corollaries to this rule.</p>
    
<ul>
      
<li>
<b>Handle Specific Exceptions in Inner Code</b>
        
<p>Inner code is code <i>deep</i> within the program. Such code should catch specific exceptions, or categories of exceptions (parents in
exception hierarchies), <u>if and only if</u> the exception can be resolved and normal flow restored to the code. Note that behaviour of this sort may be significantly different between non-interactive code versus an interactive tool.</p>
      
</li>
      
<li>
<b>Catch All Exceptions in Outermost Flow of Control</b>
        
<p>Ultimately, all exceptions must be dealt with at one level or another. For command-line tools, this means the <span class="codefrag">main</span> method
or program. For a middleware component, this is the entry point(s) into the component. For Axis this is <span class="codefrag">AxisServlet</span> or equivalent.</p>
        
<p>After catching specific exceptions which can be resolved internally, the outermost code must ensure that all internally generated exceptions are caught and handled. While there is generally not much that can be done, at a minimum the code should <u>log the exception</u>. In addition to logging, the Axis Server wraps all such exceptions in AxisFaults and returns them to the client code.</p>
        
<p>This may seem contrary to the primary rule, but in fact we are claiming that Axis does know what to do with this type of exception: exit gracefully.</p>
      
</li>
    
</ul>
  
</li>

  
<li>
<b>Catching and Logging Exceptions</b>
    
<p>When an Exception is going to cross a component boundry (client/server, or system/business logic), the exception must be caught and logged by the throwing component. It may then be rethrown, or wrapped, as described below.</p>
    
<p>When in doubt, log the exception.</p>
    
<ul>
      
<li>
<b>Catch and Throw</b>
        
<p>If an exception is caught and rethrown (unresolved), logging of the exception is at the discretion of the coder and reviewers. If any comments are logged, the exception should also be logged.</p>
        
<p>When in doubt, log the exception and any related local information that can help to identify the complete context of the exception.</p>
        
<p>Log the exception as an <i>error</i> (<span class="codefrag">log.error()</span>) if it is known to be an unresolved or unresolvable error, otherwise log it at the <i>informative</i> level (<span class="codefrag">log.info()</span>).</p>
      
</li>

      
<li>
<b>Catch and Wrap</b>
        
<p>When exception <span class="codefrag">e</span> is caught and wrapped by a new exception <span class="codefrag">w</span>, log exception <span class="codefrag">e</span> before throwing <span class="codefrag">w</span>.</p>
        
<p>Log the exception as an <i>error</i> (<span class="codefrag">log.error()</span>) if it is known to be an unresolved or unresolvable error, otherwise log it at the <i>informative</i> level (<span class="codefrag">log.info()</span>).</p>
      
</li>

      
<li>
<b>Catch and Resolve</b>
        
<p>When exception <span class="codefrag">e</span> is caught and resolved, logging of the exception is at the discretion of the coder and reviewers. If any comments are logged, the exception should also be logged (<span class="codefrag">log.info()</span>). Issues that must be balanced are performance and problem resolvability.</p>
        
<p>Note that in many cases, ignoring the exception may be appropriate.</p>
      
</li>
    
</ul>
  
</li>

  
<li>
<b>Respect Component Boundries</b>
    
<p>There are multiple aspects of this guideline. On one hand, this means that business logic should be isolated from system logic. On the other hand, this means that client's should have limited exposure/visibility to implementation details of a server - particularly when the server is published to outside parties. This implies a well designed server interface.</p>
    
<ul>
      
<li>
<b>Isolate System Logic from Business Logic</b>
        
<p>Exceptions generated by the Axis runtime should be handled, where possible, within the Axis runtime. In the worst case the details of an exception are to be logged by the Axis runtime, and a generally descriptive Exception raised to the Business Logic.</p>
        
<p>Exceptions raised in the business logic (this includes the server and Axis handlers) must be delivered to the client code.</p>
      
</li>

      
<li>
<b>Protect System Code from User Code</b>
        
<p>Protect the Axis runtime from uncontrolled user business logic. For Axis, this means that dynamically configurable <span class="codefrag">handlers</span>,
<span class="codefrag">providers</span> and other user controllable hook-points must be guarded by <span class="codefrag">catch(Exception ...)</span>. Exceptions generated by user code and caught by system code should be:</p>
        
<ul>
          
<li>Logged, and</li>
          
<li>Delivered to the client program</li>
        
</ul>
      
</li>

      
<li>
<b>Isolate Visibility into Server from Client</b>
        
<p>Specific exceptions should be logged at the server side, and a more general exception thrown to the client. This prevents clues as to the nature of the server (such as handlers, providers, etc) from being revealed to client code. The Axis component boundries that should be respected are:</p>
        
<ul>
          
<li>Client Code &lt;--&gt; AxisClient</li>
          
<li>AxisClient &lt;--&gt; AxisServlet (AxisServer/AxisEngine)</li>
          
<li>AxisServer/AxisEngine &lt;--&gt; Web Service</li>
        
</ul>
      
</li>
    
</ul>
  
</li>

  
<li>
<b>Throwing Exceptions in Constructors</b>
    
<p>Before throwing an exception in a constructor, ensure that any resources owned by the object are cleaned up. For objects holding resources, this requires catching <u>all</u> exceptions thrown by methods called within the constructor, cleaning up, and rethrowing the exceptions.</p>
  
</li>

</ul>




<a name="CompileAndRun"></a>

<div class="h4">
<h4>Compile and Run</h4>
</div>



<p>The <span class="codefrag">xml-axis/java/build.xml</span> file is the primary 'make' file used by ant to build the application and run the tests. The <span class="codefrag">build.xml</span> file defines ant build <i>targets</i>. Read the build.xml file for more information. Here are some of the useful targets:</p>


<ul>
  
<li>compile -&gt; compiles the source and creates xml-axis/java/build/lib/axis.jar</li>
  
<li>javadocs -&gt; creates the javadocs in xml-axis/java/build/javadocs</li>
  
<li>functional-tests -&gt; compiles and runs the functional tests</li>
  
<li>all-tests -&gt; compiles and runs all of the tests</li>

</ul>


<p>To compile the source code:</p>


<pre class="code">cd xml-axis/java
ant compile</pre>


<p>To run the tests:</p>


<pre class="code">cd xml-axis/java
ant functional-tests</pre>


<p>
<b>Note:</b> these tests start a server on port 8080. If this clashes with the port used by your web application server (such as Tomcat), you'll need to change one of the ports or stop your web application server when running the tests.</p>


<p>
<b>Please run <span class="codefrag">ant functional-tests</span> and <span class="codefrag">ant all-tests</span> before checking in new code.</b>
</p>




<a name="Internationalization"></a>

<div class="h4">
<h4>Internationalization</h4>
</div>



<p>If you make changes to the source code that results in the generation of text (error messages or debug information), you must follow the following guidelines to ensure that your text is properly translated.</p>


<a name="DeveloperGuidelines"></a>

<div class="h2">
<h2>Developer Guidelines</h2>
</div>



<ol>
  
<li>Your text string should be added as a property to the resource.properties file (xml-axis/java/src/org/apache/axis/i18n/resource.properties). Note that some of the utility applications (i.e. tcpmon) have their own resource property files (tcpmon.properties).</li>
  
<li>The resource.properties file contains translation and usage instructions. Entries in a message resource file are of the form &lt;key&gt;=&lt;message&gt; Here is an example message:
    <p>sample00=My name is {0}, and my title is {1}.</p>
    
<ol>
      
<li>sample00 is the key that the code will use to access this message.</li>
      
<li>The text after the = is the message text.</li>
      
<li>The {<i>number</i>} syntax defines the location for inserts.</li>
    
</ol>
  
</li>

  
<li>The code should use the static method org.apache.axis.i18n.Messages.getMessage to obtain the text and add inserts. Here is an example usage:
    <p>Messages.getMessage("sample00", "Rich Scheuerle", "Software Developer");</p>
  
</li>

  
<li>All keys in the properties file should use the syntax &lt;string&gt;&lt;2-digit-suffix&gt;.
    <ol>
      
<li>
<b>Never change the message text in the properties file.</b> The message may be used in multiple places in the code. Plus translation is only done on new keys.</li>
      
<li>If a code change requires a change to a message, create a new entry with an incremented 2-digit suffix.</li>
      
<li>All new entries should be placed at the bottom of the file to ease translation.</li>
      
<li>We may occasionally want to trim the properties file of old data, but this should only be done on major releases.</li>
    
</ol>
  
</li>

</ol>


<div class="h5">
<h5>Example</h5>
</div>



<p>Consider the following statement:</p>


<pre class="code">if (operationName == null)
  throw new AxisFault( "No operation name specified" );</pre>


<p>We will add an entry into org/apache/axis/i18n/resource.properties:</p>


<p>
<span class="codefrag">noOperation=No operation name specified.</span>
</p>


<p>And change the code to read:</p>


<pre class="code">if (operationName == null)
  throw new AxisFault(Messages.getMessage("noOperation"));</pre>






<a name="Interface"></a>

<div class="h2">
<h2>Interface</h2>
</div>



<p>Axis uses the standard Java internationalization class <span class="codefrag">java.util.ResourceBundle</span> to access property files and message strings, and uses <span class="codefrag">java.text.MessageFormat</span> to format the strings using variables. Axis provides a single class <span class="codefrag">org.apache.axis.i18n.Messages</span> that manages both ResourceBundle and MessageFormat classes. Messages methods are:</p>


<p>
<span class="codefrag">public static java.util.ResourceBundle getResourceBundle();</span>
</p>

<p>
<span class="codefrag">public static String getMessage(String key) throws java.util.MissingResourceException;</span>
</p>

<p>
<span class="codefrag">public static String getMessage(String key, String var) throws java.util.MissingResourceException;</span>
</p>

<p>
<span class="codefrag">public static String getMessage(String key, String var1, String var2) throws java.util.MissingResourceException;</span>
</p>

<p>
<span class="codefrag">public static String getMessage(String key, String[] vars) throws java.util.MissingResourceException;</span>
</p>


<p>Axis programmers can work with the resource bundle directly via a call to <span class="codefrag">Messages.getResourceBundle()</span>, but the <span class="codefrag">getMessage()</span> methods should be used instead for two reasons:</p>


<ol>
  
<li>It's a shortcut. It is cleaner to call<br>
    
<span class="codefrag">Messages.getMessage("myMsg00");</span>
<br>
    than<br>
    
<span class="codefrag">Messages.getResourceBundle().getString("myMsg00");</span>
  
</li>
  
<li>The <span class="codefrag">getMessage</span> methods enable messages with variables.</li>

</ol>


<div class="h5">
<h5>The getMessage methods</h5>
</div>



<p>If you have a message with no variables</p>


<p>
<span class="codefrag">myMsg00=This is a string.</span>
</p>


<p>then simply call</p>


<p>
<span class="codefrag">Messages.getMessage("myMsg00");</span>
</p>


<p>If you have a message with variables, use the syntax "{X}" where <span class="codefrag">X</span> is the number of the variable, starting at 0. For example:</p>


<p>
<span class="codefrag">myMsg00=My {0} is {1}.</span>
</p>


<p>then call:</p>


<p>
<span class="codefrag">Messages.getMessage("myMsg00","name", "Russell");</span>
</p>


<p>and the resulting string will be:  "My name is Russell."</p>


<p>You could also call the String array version of getMessage:</p>


<p>
<span class="codefrag">Messages.getMessage("myMsg00", new String[] {"name", "Russell"});</span>
</p>


<p>The String array version of getMessage is all that is necessary, but the vast majority of messages will have 0, 1 or 2 variables, so the other getMessage methods are provided as a convenience to avoid the complexity of the String array version.</p>


<p>Note that the getMessage methods throw MissingResourceException if the resource cannot be found. And ParseException if there are more {X} entries than arguments. These exceptions are RuntimeException's, so the caller doesn't have to explicitly catch them.</p>


<p>The resource bundle properties file is org/apache/axis/i18n/resource.properties.</p>






<a name="ExtendingMessageFiles"></a>

<div class="h2">
<h2>Extending Message Files</h2>
</div>



<p>Generally, within Axis all messages are placed in org.apache.axis.i18n.resource.properties. There are facilities for extending the messages without modifying this file for integration or 3rd party extensions to Axis. See the <a href="integration-guide.html#Internationalization">Integration Guide</a> for details.</p>






<a name="AddingTestcases"></a>

<div class="h4">
<h4>Adding Testcases</h4>
</div>



<p>See Also: <a href="#TestStructure">Test and Samples Structure</a>
</p>


<p>
<b>Editor's Note:</b> We need more effort to streamline and simplify the addition of tests. We also need to think about categorizing tests as the test bucket grows.</p>


<p>If you make changes to Axis, please add a test that uses your change. Why?</p>


<ul>
  
<li>The test validates that your new code works.</li>
  
<li>The test protects your change from bugs introduced by future code changes.</li>
  
<li>The test is an example to users of the features of Axis.</li>
  
<li>The test can be used as a starting point for new development.</li>

</ul>


<p>Some general principles:</p>


<ul>
  
<li>Tests should be self-explanatory.</li>
  
<li>Tests should not generate an abundance of output</li>
  
<li>Tests should hook into the existing junit framework.</li>
  
<li>Each test or group of related tests should have its own directory in the <span class="codefrag">xml-axis/java/test</span> directory</li>

</ul>


<p>One way to build a test is to "cut and paste" the existing tests, and then modify the test to suit your needs. This approach is becoming more complicated as the different kinds of tests grow.</p>


<p>A good "non-wsdl" test for reference is test/saaj.</p>


<a name="CreatingAWSDLTest"></a>

<div class="h2">
<h2>Creating a WSDL Test</h2>
</div>



<p>Here are the steps that I used to create the <span class="codefrag">sequence</span> test, which generates code from a wsdl file and runs a sequence validation test:</p>


<ol>
  
<li>Created a <span class="codefrag">xml-axis/java/test/wsdl/sequence</span> directory.</li>
  
<li>Created a <span class="codefrag">SequenceTest.wsdl</span> file defining the webservice.</li>
  
<li>Ran the Wsdl2java emitter to create Java files:
    <p>
<span class="codefrag">java org.apache.axis.wsdl.Wsdl2java -t -s SequenceTest.wsdl</span>
</p>
    
<ol>
      
<li>The -t option causes the emitter to generate a *TestCase.java file that hooks into the test harness. This file is operational without any additional changes. Copy the *TestCase.java file into the same directory as your wsdl file. (Ideally only the Java files that are changed need to be in your directory.) So this file is not needed, but please make sure to modify your &lt;wsdl2java ...&gt; clause (described below) to emit a
testcase.</li>
      
<li>The -s option causes the emitter to generate a *SOAPBindingImpl.java file. The Java file contains empty methods for the service. You probably want to fill them in with your own logic. Copy the *SOAPBindingImpl.java file into the same directory as your wsdl file. (If no changes are needed in the Java file, you don't need to save it. But you will need to make sure that your &lt;wsdl2java ...&gt; clause generates a skeleton).</li>
      
<li>Remove all of the Java files that don't require modification. So you should have three files in your directory (wsdl file, *TestCase.java, and *SOAPBindingImpl.java). My sequence test has an another file due to some additional logic that I needed.</li>
    
</ol>
  
</li>
  
<li>The <span class="codefrag">test/wsdl/sequence/build.xml</span> file controls the building of this test. Locate the "compile" target. Add a clause that runs the Wsdl2java code. I would recommend stealing something from the test/wsdl/roundtrip/build.xml file (it does a LOT of wsdl2java and java2wsdl calls). Here is the one for SequenceTest:
    <pre class="code">&lt;!-- Sequence Test --&gt;
&lt;wsdl2java url="${axis.home}/test/wsdl/sequence/SequenceTest.wsdl"
    output="${axis.home}/build/work"
    deployscope="session"
    skeleton="yes"
    messagecontext="no"
    noimports="no"
    verbose="no"
    testcase="no"&gt;
&lt;mapping namespace="urn:SequenceTest2" package="test.wsdl.sequence"/&gt;
&lt;/wsdl2java&gt;</pre>
  
</li>
  
<li>Enable the run target in the new build.xml file. You need to choose from the execute-Component and the (soon to be introduced) execute-Simple-Test target. These control HOW the test is invoked when run as a single component. The execute-Component sets up the tcp-server and http-server prior to running the test, as well as handles deploying and services that may be needed. The execute-Simple-test simply invokes the raw test class file.</li>
  
<li>Done. Run <span class="codefrag">ant functional-tests </span>to verify. Check in your test.</li>

</ol>






<a name="TestStructure"></a>

<div class="h4">
<h4>Test Structure</h4>
</div>



<p>
<a href="AxisTestRedesign.html">The Test and Samples Redesign Document is here</a>
</p>


<p>As of Axis 1.0, RC1, we have moved to a "componentized" test structure. Instead of having one high-level large recursive function, there are smaller, simple "component" build.xml files in the leaf level of the test/** and samples/** trees.</p>


<p>These "component" files have a common layout. Their primary targets are:</p>


<ul>
  
<li>clean - reset the build destination(s)</li>
  
<li>compile - javac, wsdl2java, java2wsdl instructions</li>
  
<li>run - "executes" the test</li>

</ul>


<p>A "sample" test xml file can be found in test/templateTest</p>




<a name="AddingSourceCodeChecks"></a>

<div class="h4">
<h4>Adding Source Code Checks</h4>
</div>



<p>The Axis build performs certain automated checks of the files in the source directory (java/src) to make sure certain conventions are followed such as using internationalised strings when issuing messages.</p>


<p>If a convention can be reduced to a regular expression match, it can be enforced at build time by updating java/test/utils/TestSrcContent.java.</p>


<p>All that is necessary is to add a pattern to the static FileNameContentPattern array. Each pattern has three parameters:</p>


<ol>
  
<li>a pattern that matches filenames that are to be checked,</li>
  
<li>a pattern to be searched for in the chosen files, and</li>
  
<li>a boolean indicating whether the pattern is to be allowed (typically false indicating not allowed).</li>

</ol>


<p>A reasonable summary of the regular expression notation is provided in the <a href="http://jakarta.apache.org/oro/api/org/apache/oro/text/regex/package-summary.html">Jakarta ORO javadocs</a>.</p>




<a name="JUnitAndAxis"></a>

<div class="h4">
<h4>JUnit and Axis</h4>
</div>



<p>You try to run some JUnit tests on an Axis client that invokes a web service, and you always get this exception:</p>


<pre class="code">java.lang.ExceptionInInitializerError 
at org.apache.axis.client.Service.&lt;init&gt;(Service.java:108) 
... 

Caused by: org.apache.commons.logging.LogConfigurationException: ... 
org.apache.commons.logging.impl.Jdk14Logger does not implement Log 
at org.apache.commons.logging.impl.LogFactoryImpl.newInstance
(LogFactoryImpl.java:555) 
...</pre>


<p>Actually, the Jdk14Logger does implement Log. What you have is a JUnit classloading issue. JUnit's graphical TestRunner has a feature where it will dynamically reload modified classes every time the user presses the "Run" button. This way, the user doesn't need to relaunch the TestRunner after every edit. For this, JUnit uses its own classloader, junit.runner.TestCaseClassLoader. As of JUnit 3.8.1, confusion can arise between TestCaseClassLoader and the system class loader as to which loader did or should load which classes.</p>


<p>There are two ways to avoid this problem.</p>


<ul>
  
<li>Sure and simple fix. Turn off dynamic class reloading by running junit.swingui.TestRunner with the -noloading argument.</li>
  
<li>Finicky and fancy fix, only necessary if you want dynamic class reloading. Tell TestCaseClassLoader to ignore certain packages and their sub-packages, deferring them to the system classloader. You can do this using a file located in junit.jar, junit/runner/excluded.properties. Its content appears as follows:
    <pre class="code">#
# The list of excluded package paths for the TestCaseClassLoader
#
excluded.0=sun.*
excluded.1=com.sun.*
excluded.2=org.omg.*
excluded.3=javax.*
excluded.4=sunw.*
excluded.5=java.*
excluded.6=org.w3c.dom.*
excluded.7=org.xml.sax.*
excluded.8=net.jini.*</pre>
  
</li>

</ul>


<p>Copy this file, preserving the directory path, into another location, e.g. deployDir. So the copied properties file's path will be deployDir/junit/runner/excluded.properties. Add an extra entry to the end of this file:</p>


<pre class="code">excluded.9=org.apache.*</pre>


<p>Edit your classpath so that deployDir appears before junit.jar. This way, the modified excluded.properties will be used, rather than the default. (Don't add the path to excluded.properties itself to the classpath.)</p>


<p>This fix will prevent the commons-logging exception. However, other classloading problems might still arise. For example:</p>


<pre class="code">Dec 10, 2002 7:16:16 PM org.apache.axis.encoding.ser.BeanPropertyTarget set 
SEVERE: Could not convert [Lfoo.bar.Child; to bean field 'childrenAsArray', 
type [Lfoo.bar.Child; 
Dec 10, 2002 7:16:16 PM org.apache.axis.client.Call invoke 
SEVERE: Exception: 
java.lang.IllegalArgumentException: argument type mismatch 
at org.apache.axis.encoding.ser.BeanPropertyTarget.set
(BeanPropertyTarget.java:182) 
at org.apache.axis.encoding.DeserializerImpl.valueComplete
(DeserializerImpl.java:284) 
...</pre>


<p>In this case, you have no choice but to give up on dynamic class reloading and use the -noloading argument.</p>


<p>One other heads-up about JUnit testing of an Axis web service. Suppose you have run JUnit tests locally on the component that you want to expose as a web service. You press the "Run" button to initiate a series of tests. Between each test, all your data structures are re-initialized. Your tests produce a long green bar. Good.</p>


<p>Suppose you now want to run JUnit tests on an Axis client that is connecting to an application server running the Axis web application and with it your web service. Between each test, JUnit will automatically re-initialize your client.</p>


<p>Your server-side data structures are a different matter. If you're checking your server data at the end of each test (as you should be) and you run more than one test at a time, the second and later tests will fail because they are generating cumulative data on the Axis server based on preceding tests rather than fresh data based only on the current one.</p>


<p>This means that, for each test, you must manually re-initialize your web service. One way to accomplish this is to add to your web service interface a re-initialize operation. Then have the client call that operation at the start of each test.</p>




<a name="UsingTcpmonToMonitorFunctionalTests"></a>

<div class="h4">
<h4>Using tcpmon to Monitor Functional Tests</h4>
</div>



<p>Here is an easy way to monitor the messages while running <span class="codefrag">functional-tests</span> (or <span class="codefrag">all-tests</span>).</p>


<p>Start up tcpmon listening on 8080 and forwarding to a different port:</p>


<p>
<span class="codefrag">java org.apache.axis.utils.tcpmon 8080 localhost 8011</span>
</p>


<p>Run your tests, but use the forwarded port for the SimpleAxisServer, and indicate that functional-tests should continue if a failure occurs.</p>


<p>
<span class="codefrag">ant functional-tests -Dtest.functional.SimpleAxisPort=8011 -Dtest.functional.fail=no</span>
</p>


<p>The SOAP messages for all of the tests should appear in the tcpmon window.</p>


<p>
<span class="codefrag">tcpmon</span> is described in more detail in the <a href="user-guide.html#AppendixUsingTheAxisTCPMonitorTcpmon">Axis User's Guide</a>.</p>




<a name="UsingSOAPMonitorToMonitorFunctionalTests"></a>

<div class="h4">
<h4>Using SOAP Monitor to Monitor Functional Tests</h4>
</div>



<p>If you are debugging code that is running as a web application using a web application server (such as Tomcat) then you may also use the SOAP Monitor utility to view the SOAP request and response messages.</p>


<p>Start up the SOAP monitor utility by loading the SOAP monitor applet in your web browser window:</p>


<p>
<span class="codefrag">http://localhost:&lt;port&gt;/axis/SOAPMonitor</span>
</p>


<p>As you run your tests, the SOAP messages should appear in the SOAP monitor window.</p>


<p>
<span class="codefrag">SOAP Monitor</span> is described in more detail in the <a href="user-guide.html#AppendixUsingTheSOAPMonitor">Axis User's Guide</a>.</p>




<a name="RunningASingleFunctionalTest"></a>

<div class="h4">
<h4>Running a Single Functional Test</h4>
</div>



<p>In one window start the server:</p>


<p>
<span class="codefrag">java org.apache.axis.transport.http.SimpleAxisServer -p 8080</span>
</p>


<p>In another window, first deploy the service you're testing:</p>


<p>
<span class="codefrag">java org.apache.axis.client.AdminClient deploy.wsdd</span>
</p>


<p>Then bring up the JUnit user interface with your test. For example, to run the the multithread test case:</p>


<p>
<span class="codefrag">java junit.swingui.TestRunner -noloading test.wsdl.multithread.MultithreadTestCase</span>
</p>




<a name="Debugging"></a>

<div class="h4">
<h4>Debugging</h4>
</div>



<a name="TurningOnDebugOutput"></a>

<div class="h2">
<h2>Turning on Debug Output</h2>
</div>



<p>This section is oriented to the Axis default logger: Log4J. For additional information on Log4J, see the section <a href="#Logging/Tracing">Configuring the Logger</a>.</p>


<ul>
  
<li>
<b>Overriding Log4J properties</b>
    
<p>The <span class="codefrag">log4j.properties</span> file is packaged in <span class="codefrag">axis.jar</span> with reasonable default settings. Subsequent items presume changes to these settings. There are multiple options open to the developer, most of which involve extracting <span class="codefrag">log4j.properties</span> from <span class="codefrag">axis.jar</span> and modifying as appropriate.</p>
    
<ul>
      
<li>If you are building and executing <span class="codefrag">Java</span> programs from a command line or script file, include the JVM option <span class="codefrag">-Dlog4j.configuration=yourConfigFile</span>.</li>
      
<li>Set <span class="codefrag">CLASSPATH</span> such that your version of <span class="codefrag">log4j.properties</span> appears prior to <span class="codefrag">axis.jar</span> in the <span class="codefrag">CLASSPATH</span>.</li>
      
<li>If you are building and executing your programs using <span class="codefrag">ant</span> (this includes building Axis and running it's tests), set the environment variable <span class="codefrag">ANT_OPTS</span> to <span class="codefrag">-Dlog4j.configuration=yourConfigFile</span>.</li>
      
<li>If you are building Axis, you can change <span class="codefrag">src/log4j.properties</span> directly. Be sure NOT to commit your change(s).</li>
    
</ul>
  
</li>

  
<li>
<b>Turning on ALL DEBUG Output</b>
    
<ul>
      
<li>Set the <span class="codefrag">log4j.rootCategory</span> <i>priority</i> to <span class="codefrag">DEBUG</span>.</li>
      
<li>Set the <i>priority</i> threshold for an appender to <span class="codefrag">DEBUG</span> (The <span class="codefrag">log4j.properties</span> file in Axis defines two appenders: <span class="codefrag">CONSOLE</span> and <span class="codefrag">LOGFILE</span>).</li>
    
</ul>
  
</li>

  
<li>
<b>Selective DEBUG Output</b>
    
<ul>
      
<li>Set the <span class="codefrag">log4j.rootCategory</span> <i>priority</i> to <span class="codefrag">INFO</span> or higher.</li>
      
<li>Set the <span class="codefrag">log4j.logger.logger.name</span> <i>priority</i> to <span class="codefrag">DEBUG</span> for the loggers that you are interested in.</li>
      
<li>Set the <i>priority</i> threshold for an appender to <span class="codefrag">DEBUG</span> (The <span class="codefrag">log4j.properties</span> file in Axis defines two appenders: <span class="codefrag">CONSOLE</span> and <span class="codefrag">LOGFILE</span>).</li>
      
<li>If you are still seeing more than you want to see, you will need to use other tools to extract the information you are interested in from the log output. Use appropriate key words in log messages and use tools such as <span class="codefrag">grep</span> to search for them in log messages.</li>
    
</ul>
  
</li>

</ul>




<a name="WritingTemporaryOutput"></a>

<div class="h2">
<h2>Writing Temporary Output</h2>
</div>



<p>Remember that Axis is targeted for use in a number of open-source and other web applications, and so it needs to be a good citizen. Writing output using <span class="codefrag">System.out.println</span> or <span class="codefrag">System.err.println</span> should be avoided.</p>


<p>Developers may be tempted to use <span class="codefrag">System.out.println</span> while debugging or analyzing a system. If you choose to do this, you will need to disable the <span class="codefrag">util/TestSrcContent</span> test, which enforces avoidance of <span class="codefrag">System.out.println</span> and <span class="codefrag">System.err.println</span>. It follows that you will need to remove your statements before checking the code back in.</p>


<p>As an alternative, we strongly encourage you to take a few moments and introduce debug statements: <span class="codefrag">log.debug("reasonably terse and meaningful message")</span>. If a debug message is useful for understanding a problem now, it may be useful again in the future to you or a peer.</p>






<a name="RunningTheJAX-RPCCompatibilityTests"></a>

<div class="h4">
<h4>Running the JAX-RPC Compatibility Tests</h4>
</div>



<p>As well as a specification, JAX-RPC has a Technology Compatibility Kit (TCK) which is available to members of the JAX-RPC Expert Group (and others?).</p>


<p>The kit comes as a zip file which you should unzip into a directory of your choosing. The installation instructions are in the JAX-RPC Release Notes document which is stored in the docs directory. If you open the index.html file in the docs directory using a web browser, you'll see a list of all the documents supplied with the kit.</p>


<p>Note that the kit includes the JavaTest test harness which is used for running the compatibility tests.</p>


<p>If any more information is needed about running these tests, please add it here!</p>





  

<div id="pdf" align="right">
<a href="developers-guide.pdf"><img alt="PDF" src="../skin/images/pdfdoc.gif" class="skin"><br>
          PDF</a>
</div>
</div>
</div>
</div>
</td>
</tr>
</tbody>
</table>
<div id="footer">
<table summary="footer" cellspacing="0" cellpadding="4" width="100%" border="0">
<tbody>
<tr>
<td colspan="2">
<div align="center">
<div class="copyright">
              Copyright &copy; 2000-2005&nbsp;The Apache Software Foundation. All rights reserved.
            </div>
</div>
</td>
</tr>
<tr>
<td align="left"></td><td align="right">
<div align="right">
<div class="credit"></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</body>
</html>
